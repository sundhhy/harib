     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_memman_alloc_4k
     7 00000000                                 	EXTERN	_set_segmdesc
     8 00000000                                 	EXTERN	_load_tr
     9 00000000                                 	EXTERN	_timer_alloc
    10 00000000                                 	EXTERN	_timer_settime
    11 00000000                                 	EXTERN	_farjmp
    12 00000000                                 [FILE "mtask.c"]
    13                                          [SECTION .text]
    14 00000000                                 	GLOBAL	_Task_init
    15 00000000                                 _Task_init:
    16 00000000 55                              	PUSH	EBP
    17 00000001 89 E5                           	MOV	EBP,ESP
    18 00000003 57                              	PUSH	EDI
    19 00000004 56                              	PUSH	ESI
    20 00000005 31 FF                           	XOR	EDI,EDI
    21 00000007 53                              	PUSH	EBX
    22 00000008 BE 000003E7                     	MOV	ESI,999
    23 0000000D 68 0001C528                     	PUSH	116008
    24 00000012 31 DB                           	XOR	EBX,EBX
    25 00000014 FF 75 08                        	PUSH	DWORD [8+EBP]
    26 00000017 E8 [00000000]                   	CALL	_memman_alloc_4k
    27 0000001C A3 [00000004]                   	MOV	DWORD [_p_taskctl],EAX
    28 00000021 58                              	POP	EAX
    29 00000022 5A                              	POP	EDX
    30 00000023                                 L6:
    31 00000023 89 F8                           	MOV	EAX,EDI
    32 00000025 8D 53 18                        	LEA	EDX,DWORD [24+EBX]
    33 00000028 03 05 [00000004]                	ADD	EAX,DWORD [_p_taskctl]
    34 0000002E 83 C7 70                        	ADD	EDI,112
    35 00000031 C7 80 00000FAC 00000000         	MOV	DWORD [4012+EAX],0
    36 0000003B 89 90 00000FA8                  	MOV	DWORD [4008+EAX],EDX
    37 00000041 8D 88 00000FA8                  	LEA	ECX,DWORD [4008+EAX]
    38 00000047 68 00000089                     	PUSH	137
    39 0000004C 8D 83 00270018                  	LEA	EAX,DWORD [2555928+EBX]
    40 00000052 51                              	PUSH	ECX
    41 00000053 83 C3 08                        	ADD	EBX,8
    42 00000056 6A 67                           	PUSH	103
    43 00000058 50                              	PUSH	EAX
    44 00000059 E8 [00000000]                   	CALL	_set_segmdesc
    45 0000005E 83 C4 10                        	ADD	ESP,16
    46 00000061 4E                              	DEC	ESI
    47 00000062 79 BF                           	JNS	L6
    48 00000064 E8 00000041                     	CALL	_Task_alloc
    49 00000069 89 C3                           	MOV	EBX,EAX
    50 0000006B C7 40 04 00000002               	MOV	DWORD [4+EAX],2
    51 00000072 A1 [00000004]                   	MOV	EAX,DWORD [_p_taskctl]
    52 00000077 C7 00 00000001                  	MOV	DWORD [EAX],1
    53 0000007D 89 58 08                        	MOV	DWORD [8+EAX],EBX
    54 00000080 C7 40 04 00000000               	MOV	DWORD [4+EAX],0
    55 00000087 FF 33                           	PUSH	DWORD [EBX]
    56 00000089 E8 [00000000]                   	CALL	_load_tr
    57 0000008E E8 [00000000]                   	CALL	_timer_alloc
    58 00000093 6A 02                           	PUSH	2
    59 00000095 A3 [00000000]                   	MOV	DWORD [_p_mt_timer],EAX
    60 0000009A 50                              	PUSH	EAX
    61 0000009B E8 [00000000]                   	CALL	_timer_settime
    62 000000A0 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
    63 000000A3 89 D8                           	MOV	EAX,EBX
    64 000000A5 5B                              	POP	EBX
    65 000000A6 5E                              	POP	ESI
    66 000000A7 5F                              	POP	EDI
    67 000000A8 5D                              	POP	EBP
    68 000000A9 C3                              	RET
    69 000000AA                                 	GLOBAL	_Task_alloc
    70 000000AA                                 _Task_alloc:
    71 000000AA 55                              	PUSH	EBP
    72 000000AB 31 C9                           	XOR	ECX,ECX
    73 000000AD 89 E5                           	MOV	EBP,ESP
    74 000000AF 31 D2                           	XOR	EDX,EDX
    75 000000B1                                 L15:
    76 000000B1 89 D0                           	MOV	EAX,EDX
    77 000000B3 03 05 [00000004]                	ADD	EAX,DWORD [_p_taskctl]
    78 000000B9 83 B8 00000FAC 00               	CMP	DWORD [4012+EAX],0
    79 000000C0 74 10                           	JE	L18
    80 000000C2 41                              	INC	ECX
    81 000000C3 83 C2 70                        	ADD	EDX,112
    82 000000C6 81 F9 000003E7                  	CMP	ECX,999
    83 000000CC 7E E3                           	JLE	L15
    84 000000CE 31 C0                           	XOR	EAX,EAX
    85 000000D0                                 L9:
    86 000000D0 5D                              	POP	EBP
    87 000000D1 C3                              	RET
    88 000000D2                                 L18:
    89 000000D2 05 00000FA8                     	ADD	EAX,4008
    90 000000D7 C7 40 04 00000001               	MOV	DWORD [4+EAX],1
    91 000000DE C7 40 2C 00000202               	MOV	DWORD [44+EAX],514
    92 000000E5 C7 40 30 00000000               	MOV	DWORD [48+EAX],0
    93 000000EC C7 40 34 00000000               	MOV	DWORD [52+EAX],0
    94 000000F3 C7 40 38 00000000               	MOV	DWORD [56+EAX],0
    95 000000FA C7 40 3C 00000000               	MOV	DWORD [60+EAX],0
    96 00000101 C7 40 40 00000000               	MOV	DWORD [64+EAX],0
    97 00000108 C7 40 44 00000000               	MOV	DWORD [68+EAX],0
    98 0000010F C7 40 48 00000000               	MOV	DWORD [72+EAX],0
    99 00000116 C7 40 4C 00000000               	MOV	DWORD [76+EAX],0
   100 0000011D C7 40 50 00000000               	MOV	DWORD [80+EAX],0
   101 00000124 C7 40 54 00000000               	MOV	DWORD [84+EAX],0
   102 0000012B C7 40 58 00000000               	MOV	DWORD [88+EAX],0
   103 00000132 C7 40 5C 00000000               	MOV	DWORD [92+EAX],0
   104 00000139 C7 40 60 00000000               	MOV	DWORD [96+EAX],0
   105 00000140 C7 40 64 00000000               	MOV	DWORD [100+EAX],0
   106 00000147 C7 40 68 00000000               	MOV	DWORD [104+EAX],0
   107 0000014E C7 40 6C 40000000               	MOV	DWORD [108+EAX],1073741824
   108 00000155 E9 FFFFFF76                     	JMP	L9
   109 0000015A                                 	GLOBAL	_Task_run
   110 0000015A                                 _Task_run:
   111 0000015A 55                              	PUSH	EBP
   112 0000015B 8B 15 [00000004]                	MOV	EDX,DWORD [_p_taskctl]
   113 00000161 89 E5                           	MOV	EBP,ESP
   114 00000163 8B 4D 08                        	MOV	ECX,DWORD [8+EBP]
   115 00000166 C7 41 04 00000002               	MOV	DWORD [4+ECX],2
   116 0000016D 8B 02                           	MOV	EAX,DWORD [EDX]
   117 0000016F 89 4C 82 08                     	MOV	DWORD [8+EDX+EAX*4],ECX
   118 00000173 40                              	INC	EAX
   119 00000174 89 02                           	MOV	DWORD [EDX],EAX
   120 00000176 5D                              	POP	EBP
   121 00000177 C3                              	RET
   122 00000178                                 	GLOBAL	_Task_sleep
   123 00000178                                 _Task_sleep:
   124 00000178 55                              	PUSH	EBP
   125 00000179 89 E5                           	MOV	EBP,ESP
   126 0000017B 57                              	PUSH	EDI
   127 0000017C 56                              	PUSH	ESI
   128 0000017D 31 FF                           	XOR	EDI,EDI
   129 0000017F 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   130 00000182 53                              	PUSH	EBX
   131 00000183 31 DB                           	XOR	EBX,EBX
   132 00000185 83 7E 04 02                     	CMP	DWORD [4+ESI],2
   133 00000189 74 08                           	JE	L40
   134 0000018B                                 L20:
   135 0000018B 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   136 0000018E 5B                              	POP	EBX
   137 0000018F 5E                              	POP	ESI
   138 00000190 5F                              	POP	EDI
   139 00000191 5D                              	POP	EBP
   140 00000192 C3                              	RET
   141 00000193                                 L40:
   142 00000193 8B 15 [00000004]                	MOV	EDX,DWORD [_p_taskctl]
   143 00000199 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   144 0000019C 3B 74 82 08                     	CMP	ESI,DWORD [8+EDX+EAX*4]
   145 000001A0 74 6C                           	JE	L41
   146 000001A2                                 L22:
   147 000001A2 3B 1A                           	CMP	EBX,DWORD [EDX]
   148 000001A4 7D E5                           	JGE	L20
   149 000001A6                                 L36:
   150 000001A6 8B 15 [00000004]                	MOV	EDX,DWORD [_p_taskctl]
   151 000001AC 3B 74 9A 08                     	CMP	ESI,DWORD [8+EDX+EBX*4]
   152 000001B0 74 D9                           	JE	L20
   153 000001B2 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   154 000001B5 FF 0A                           	DEC	DWORD [EDX]
   155 000001B7 39 C3                           	CMP	EBX,EAX
   156 000001B9 7D 04                           	JGE	L28
   157 000001BB 48                              	DEC	EAX
   158 000001BC 89 42 04                        	MOV	DWORD [4+EDX],EAX
   159 000001BF                                 L28:
   160 000001BF 89 D1                           	MOV	ECX,EDX
   161 000001C1 3B 1A                           	CMP	EBX,DWORD [EDX]
   162 000001C3 7D 0D                           	JGE	L39
   163 000001C5                                 L33:
   164 000001C5 8B 44 99 0C                     	MOV	EAX,DWORD [12+ECX+EBX*4]
   165 000001C9 89 44 99 08                     	MOV	DWORD [8+ECX+EBX*4],EAX
   166 000001CD 43                              	INC	EBX
   167 000001CE 3B 19                           	CMP	EBX,DWORD [ECX]
   168 000001D0 7C F3                           	JL	L33
   169 000001D2                                 L39:
   170 000001D2 89 F8                           	MOV	EAX,EDI
   171 000001D4 C7 46 04 00000001               	MOV	DWORD [4+ESI],1
   172 000001DB 84 C0                           	TEST	AL,AL
   173 000001DD 74 20                           	JE	L25
   174 000001DF 8B 02                           	MOV	EAX,DWORD [EDX]
   175 000001E1 39 42 04                        	CMP	DWORD [4+EDX],EAX
   176 000001E4 7C 07                           	JL	L35
   177 000001E6 C7 42 04 00000000               	MOV	DWORD [4+EDX],0
   178 000001ED                                 L35:
   179 000001ED 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   180 000001F0 8B 44 82 08                     	MOV	EAX,DWORD [8+EDX+EAX*4]
   181 000001F4 FF 30                           	PUSH	DWORD [EAX]
   182 000001F6 6A 00                           	PUSH	0
   183 000001F8 E8 [00000000]                   	CALL	_farjmp
   184 000001FD 59                              	POP	ECX
   185 000001FE 58                              	POP	EAX
   186 000001FF                                 L25:
   187 000001FF A1 [00000004]                   	MOV	EAX,DWORD [_p_taskctl]
   188 00000204 43                              	INC	EBX
   189 00000205 3B 18                           	CMP	EBX,DWORD [EAX]
   190 00000207 7C 9D                           	JL	L36
   191 00000209 E9 FFFFFF7D                     	JMP	L20
   192 0000020E                                 L41:
   193 0000020E BF 00000001                     	MOV	EDI,1
   194 00000213 EB 8D                           	JMP	L22
   195 00000215                                 	GLOBAL	_Task_switch
   196 00000215                                 _Task_switch:
   197 00000215 55                              	PUSH	EBP
   198 00000216 89 E5                           	MOV	EBP,ESP
   199 00000218 6A 02                           	PUSH	2
   200 0000021A FF 35 [00000000]                	PUSH	DWORD [_p_mt_timer]
   201 00000220 E8 [00000000]                   	CALL	_timer_settime
   202 00000225 58                              	POP	EAX
   203 00000226 8B 15 [00000004]                	MOV	EDX,DWORD [_p_taskctl]
   204 0000022C 58                              	POP	EAX
   205 0000022D 8B 0A                           	MOV	ECX,DWORD [EDX]
   206 0000022F 83 F9 01                        	CMP	ECX,1
   207 00000232 7E 1D                           	JLE	L42
   208 00000234 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   209 00000237 40                              	INC	EAX
   210 00000238 89 42 04                        	MOV	DWORD [4+EDX],EAX
   211 0000023B 39 C8                           	CMP	EAX,ECX
   212 0000023D 74 14                           	JE	L45
   213 0000023F                                 L44:
   214 0000023F 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   215 00000242 8B 44 82 08                     	MOV	EAX,DWORD [8+EDX+EAX*4]
   216 00000246 FF 30                           	PUSH	DWORD [EAX]
   217 00000248 6A 00                           	PUSH	0
   218 0000024A E8 [00000000]                   	CALL	_farjmp
   219 0000024F 58                              	POP	EAX
   220 00000250 5A                              	POP	EDX
   221 00000251                                 L42:
   222 00000251 C9                              	LEAVE
   223 00000252 C3                              	RET
   224 00000253                                 L45:
   225 00000253 C7 42 04 00000000               	MOV	DWORD [4+EDX],0
   226 0000025A EB E3                           	JMP	L44
   227 0000025C                                 	GLOBAL	_p_mt_timer
   228                                          [SECTION .data]
   229 00000000                                 	ALIGNB	4
   230 00000000                                 _p_mt_timer:
   231 00000000 00 00 00 00                     	RESB	4
   232 00000004                                 	GLOBAL	_p_taskctl
   233                                          [SECTION .data]
   234 00000004                                 	ALIGNB	4
   235 00000004                                 _p_taskctl:
   236 00000004 00 00 00 00                     	RESB	4
