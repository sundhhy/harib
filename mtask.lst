     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_memman_alloc_4k
     7 00000000                                 	EXTERN	_set_segmdesc
     8 00000000                                 	EXTERN	_load_tr
     9 00000000                                 	EXTERN	_timer_alloc
    10 00000000                                 	EXTERN	_timer_settime
    11 00000000                                 	EXTERN	_farjmp
    12 00000000                                 [FILE "mtask.c"]
    13                                          [SECTION .text]
    14 00000000                                 	GLOBAL	_Task_init
    15 00000000                                 _Task_init:
    16 00000000 55                              	PUSH	EBP
    17 00000001 89 E5                           	MOV	EBP,ESP
    18 00000003 57                              	PUSH	EDI
    19 00000004 56                              	PUSH	ESI
    20 00000005 31 FF                           	XOR	EDI,EDI
    21 00000007 53                              	PUSH	EBX
    22 00000008 BE 000003E7                     	MOV	ESI,999
    23 0000000D 68 0001C528                     	PUSH	116008
    24 00000012 31 DB                           	XOR	EBX,EBX
    25 00000014 FF 75 08                        	PUSH	DWORD [8+EBP]
    26 00000017 E8 [00000000]                   	CALL	_memman_alloc_4k
    27 0000001C A3 [00000004]                   	MOV	DWORD [_p_taskctl],EAX
    28 00000021 58                              	POP	EAX
    29 00000022 5A                              	POP	EDX
    30 00000023                                 L6:
    31 00000023 89 F8                           	MOV	EAX,EDI
    32 00000025 8D 53 18                        	LEA	EDX,DWORD [24+EBX]
    33 00000028 03 05 [00000004]                	ADD	EAX,DWORD [_p_taskctl]
    34 0000002E 83 C7 70                        	ADD	EDI,112
    35 00000031 C7 80 00000FAC 00000000         	MOV	DWORD [4012+EAX],0
    36 0000003B 89 90 00000FA8                  	MOV	DWORD [4008+EAX],EDX
    37 00000041 8D 88 00000FA8                  	LEA	ECX,DWORD [4008+EAX]
    38 00000047 68 00000089                     	PUSH	137
    39 0000004C 8D 83 00270018                  	LEA	EAX,DWORD [2555928+EBX]
    40 00000052 51                              	PUSH	ECX
    41 00000053 83 C3 08                        	ADD	EBX,8
    42 00000056 6A 67                           	PUSH	103
    43 00000058 50                              	PUSH	EAX
    44 00000059 E8 [00000000]                   	CALL	_set_segmdesc
    45 0000005E 83 C4 10                        	ADD	ESP,16
    46 00000061 4E                              	DEC	ESI
    47 00000062 79 BF                           	JNS	L6
    48 00000064 E8 00000041                     	CALL	_Task_alloc
    49 00000069 89 C3                           	MOV	EBX,EAX
    50 0000006B C7 40 04 00000002               	MOV	DWORD [4+EAX],2
    51 00000072 A1 [00000004]                   	MOV	EAX,DWORD [_p_taskctl]
    52 00000077 C7 00 00000001                  	MOV	DWORD [EAX],1
    53 0000007D 89 58 08                        	MOV	DWORD [8+EAX],EBX
    54 00000080 C7 40 04 00000000               	MOV	DWORD [4+EAX],0
    55 00000087 FF 33                           	PUSH	DWORD [EBX]
    56 00000089 E8 [00000000]                   	CALL	_load_tr
    57 0000008E E8 [00000000]                   	CALL	_timer_alloc
    58 00000093 6A 02                           	PUSH	2
    59 00000095 A3 [00000000]                   	MOV	DWORD [_p_mt_timer],EAX
    60 0000009A 50                              	PUSH	EAX
    61 0000009B E8 [00000000]                   	CALL	_timer_settime
    62 000000A0 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
    63 000000A3 89 D8                           	MOV	EAX,EBX
    64 000000A5 5B                              	POP	EBX
    65 000000A6 5E                              	POP	ESI
    66 000000A7 5F                              	POP	EDI
    67 000000A8 5D                              	POP	EBP
    68 000000A9 C3                              	RET
    69 000000AA                                 	GLOBAL	_Task_alloc
    70 000000AA                                 _Task_alloc:
    71 000000AA 55                              	PUSH	EBP
    72 000000AB 31 C9                           	XOR	ECX,ECX
    73 000000AD 89 E5                           	MOV	EBP,ESP
    74 000000AF 31 D2                           	XOR	EDX,EDX
    75 000000B1                                 L15:
    76 000000B1 89 D0                           	MOV	EAX,EDX
    77 000000B3 03 05 [00000004]                	ADD	EAX,DWORD [_p_taskctl]
    78 000000B9 83 B8 00000FAC 00               	CMP	DWORD [4012+EAX],0
    79 000000C0 74 10                           	JE	L18
    80 000000C2 41                              	INC	ECX
    81 000000C3 83 C2 70                        	ADD	EDX,112
    82 000000C6 81 F9 000003E7                  	CMP	ECX,999
    83 000000CC 7E E3                           	JLE	L15
    84 000000CE 31 C0                           	XOR	EAX,EAX
    85 000000D0                                 L9:
    86 000000D0 5D                              	POP	EBP
    87 000000D1 C3                              	RET
    88 000000D2                                 L18:
    89 000000D2 05 00000FA8                     	ADD	EAX,4008
    90 000000D7 C7 40 04 00000001               	MOV	DWORD [4+EAX],1
    91 000000DE C7 40 2C 00000202               	MOV	DWORD [44+EAX],514
    92 000000E5 C7 40 30 00000000               	MOV	DWORD [48+EAX],0
    93 000000EC C7 40 34 00000000               	MOV	DWORD [52+EAX],0
    94 000000F3 C7 40 38 00000000               	MOV	DWORD [56+EAX],0
    95 000000FA C7 40 3C 00000000               	MOV	DWORD [60+EAX],0
    96 00000101 C7 40 40 00000000               	MOV	DWORD [64+EAX],0
    97 00000108 C7 40 44 00000000               	MOV	DWORD [68+EAX],0
    98 0000010F C7 40 48 00000000               	MOV	DWORD [72+EAX],0
    99 00000116 C7 40 4C 00000000               	MOV	DWORD [76+EAX],0
   100 0000011D C7 40 50 00000000               	MOV	DWORD [80+EAX],0
   101 00000124 C7 40 54 00000000               	MOV	DWORD [84+EAX],0
   102 0000012B C7 40 58 00000000               	MOV	DWORD [88+EAX],0
   103 00000132 C7 40 5C 00000000               	MOV	DWORD [92+EAX],0
   104 00000139 C7 40 60 00000000               	MOV	DWORD [96+EAX],0
   105 00000140 C7 40 64 00000000               	MOV	DWORD [100+EAX],0
   106 00000147 C7 40 68 00000000               	MOV	DWORD [104+EAX],0
   107 0000014E C7 40 6C 40000000               	MOV	DWORD [108+EAX],1073741824
   108 00000155 E9 FFFFFF76                     	JMP	L9
   109 0000015A                                 	GLOBAL	_Task_run
   110 0000015A                                 _Task_run:
   111 0000015A 55                              	PUSH	EBP
   112 0000015B 8B 15 [00000004]                	MOV	EDX,DWORD [_p_taskctl]
   113 00000161 89 E5                           	MOV	EBP,ESP
   114 00000163 8B 4D 08                        	MOV	ECX,DWORD [8+EBP]
   115 00000166 C7 41 04 00000002               	MOV	DWORD [4+ECX],2
   116 0000016D 8B 02                           	MOV	EAX,DWORD [EDX]
   117 0000016F 89 4C 82 08                     	MOV	DWORD [8+EDX+EAX*4],ECX
   118 00000173 40                              	INC	EAX
   119 00000174 89 02                           	MOV	DWORD [EDX],EAX
   120 00000176 5D                              	POP	EBP
   121 00000177 C3                              	RET
   122 00000178                                 	GLOBAL	_Task_switch
   123 00000178                                 _Task_switch:
   124 00000178 55                              	PUSH	EBP
   125 00000179 89 E5                           	MOV	EBP,ESP
   126 0000017B 6A 02                           	PUSH	2
   127 0000017D FF 35 [00000000]                	PUSH	DWORD [_p_mt_timer]
   128 00000183 E8 [00000000]                   	CALL	_timer_settime
   129 00000188 58                              	POP	EAX
   130 00000189 8B 15 [00000004]                	MOV	EDX,DWORD [_p_taskctl]
   131 0000018F 58                              	POP	EAX
   132 00000190 8B 0A                           	MOV	ECX,DWORD [EDX]
   133 00000192 83 F9 01                        	CMP	ECX,1
   134 00000195 7E 1D                           	JLE	L20
   135 00000197 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   136 0000019A 40                              	INC	EAX
   137 0000019B 89 42 04                        	MOV	DWORD [4+EDX],EAX
   138 0000019E 39 C8                           	CMP	EAX,ECX
   139 000001A0 74 14                           	JE	L23
   140 000001A2                                 L22:
   141 000001A2 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   142 000001A5 8B 44 82 08                     	MOV	EAX,DWORD [8+EDX+EAX*4]
   143 000001A9 FF 30                           	PUSH	DWORD [EAX]
   144 000001AB 6A 00                           	PUSH	0
   145 000001AD E8 [00000000]                   	CALL	_farjmp
   146 000001B2 59                              	POP	ECX
   147 000001B3 58                              	POP	EAX
   148 000001B4                                 L20:
   149 000001B4 C9                              	LEAVE
   150 000001B5 C3                              	RET
   151 000001B6                                 L23:
   152 000001B6 C7 42 04 00000000               	MOV	DWORD [4+EDX],0
   153 000001BD EB E3                           	JMP	L22
   154 000001BF                                 	GLOBAL	_p_mt_timer
   155                                          [SECTION .data]
   156 00000000                                 	ALIGNB	4
   157 00000000                                 _p_mt_timer:
   158 00000000 00 00 00 00                     	RESB	4
   159 00000004                                 	GLOBAL	_p_taskctl
   160                                          [SECTION .data]
   161 00000004                                 	ALIGNB	4
   162 00000004                                 _p_taskctl:
   163 00000004 00 00 00 00                     	RESB	4
