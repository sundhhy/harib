     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_io_load_eflags
     7 00000000                                 	EXTERN	_io_store_eflags
     8 00000000                                 	EXTERN	_memtest_sub
     9 00000000                                 	EXTERN	_load_cr0
    10 00000000                                 	EXTERN	_store_cr0
    11 00000000                                 [FILE "memman.c"]
    12                                          [SECTION .text]
    13 00000000                                 	GLOBAL	_memtest
    14 00000000                                 _memtest:
    15 00000000 55                              	PUSH	EBP
    16 00000001 89 E5                           	MOV	EBP,ESP
    17 00000003 56                              	PUSH	ESI
    18 00000004 53                              	PUSH	EBX
    19 00000005 31 F6                           	XOR	ESI,ESI
    20 00000007 E8 [00000000]                   	CALL	_io_load_eflags
    21 0000000C 0D 00040000                     	OR	EAX,262144
    22 00000011 50                              	PUSH	EAX
    23 00000012 E8 [00000000]                   	CALL	_io_store_eflags
    24 00000017 E8 [00000000]                   	CALL	_io_load_eflags
    25 0000001C 5A                              	POP	EDX
    26 0000001D A9 00040000                     	TEST	EAX,262144
    27 00000022 74 05                           	JE	L2
    28 00000024 BE 00000001                     	MOV	ESI,1
    29 00000029                                 L2:
    30 00000029 89 F0                           	MOV	EAX,ESI
    31 0000002B 84 C0                           	TEST	AL,AL
    32 0000002D 75 31                           	JNE	L5
    33 0000002F                                 L3:
    34 0000002F FF 75 0C                        	PUSH	DWORD [12+EBP]
    35 00000032 FF 75 08                        	PUSH	DWORD [8+EBP]
    36 00000035 E8 [00000000]                   	CALL	_memtest_sub
    37 0000003A 5A                              	POP	EDX
    38 0000003B 89 C3                           	MOV	EBX,EAX
    39 0000003D 59                              	POP	ECX
    40 0000003E 89 F0                           	MOV	EAX,ESI
    41 00000040 84 C0                           	TEST	AL,AL
    42 00000042 75 09                           	JNE	L6
    43 00000044                                 L4:
    44 00000044 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
    45 00000047 89 D8                           	MOV	EAX,EBX
    46 00000049 5B                              	POP	EBX
    47 0000004A 5E                              	POP	ESI
    48 0000004B 5D                              	POP	EBP
    49 0000004C C3                              	RET
    50 0000004D                                 L6:
    51 0000004D E8 [00000000]                   	CALL	_load_cr0
    52 00000052 25 9FFFFFFF                     	AND	EAX,-1610612737
    53 00000057 50                              	PUSH	EAX
    54 00000058 E8 [00000000]                   	CALL	_store_cr0
    55 0000005D 58                              	POP	EAX
    56 0000005E EB E4                           	JMP	L4
    57 00000060                                 L5:
    58 00000060 E8 [00000000]                   	CALL	_load_cr0
    59 00000065 0D 60000000                     	OR	EAX,1610612736
    60 0000006A 50                              	PUSH	EAX
    61 0000006B E8 [00000000]                   	CALL	_store_cr0
    62 00000070 5B                              	POP	EBX
    63 00000071 EB BC                           	JMP	L3
    64 00000073                                 	GLOBAL	_memman_init
    65 00000073                                 _memman_init:
    66 00000073 55                              	PUSH	EBP
    67 00000074 89 E5                           	MOV	EBP,ESP
    68 00000076 8B 45 08                        	MOV	EAX,DWORD [8+EBP]
    69 00000079 C7 00 00000000                  	MOV	DWORD [EAX],0
    70 0000007F C7 40 04 00000000               	MOV	DWORD [4+EAX],0
    71 00000086 C7 40 08 00000000               	MOV	DWORD [8+EAX],0
    72 0000008D C7 40 0C 00000000               	MOV	DWORD [12+EAX],0
    73 00000094 5D                              	POP	EBP
    74 00000095 C3                              	RET
    75 00000096                                 	GLOBAL	_memman_total
    76 00000096                                 _memman_total:
    77 00000096 55                              	PUSH	EBP
    78 00000097 31 C0                           	XOR	EAX,EAX
    79 00000099 89 E5                           	MOV	EBP,ESP
    80 0000009B 31 D2                           	XOR	EDX,EDX
    81 0000009D 53                              	PUSH	EBX
    82 0000009E 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
    83 000000A1 8B 0B                           	MOV	ECX,DWORD [EBX]
    84 000000A3 39 C8                           	CMP	EAX,ECX
    85 000000A5 73 09                           	JAE	L15
    86 000000A7                                 L13:
    87 000000A7 03 44 D3 14                     	ADD	EAX,DWORD [20+EBX+EDX*8]
    88 000000AB 42                              	INC	EDX
    89 000000AC 39 CA                           	CMP	EDX,ECX
    90 000000AE 72 F7                           	JB	L13
    91 000000B0                                 L15:
    92 000000B0 5B                              	POP	EBX
    93 000000B1 5D                              	POP	EBP
    94 000000B2 C3                              	RET
    95 000000B3                                 	GLOBAL	_memman_alloc
    96 000000B3                                 _memman_alloc:
    97 000000B3 55                              	PUSH	EBP
    98 000000B4 31 C9                           	XOR	ECX,ECX
    99 000000B6 89 E5                           	MOV	EBP,ESP
   100 000000B8 57                              	PUSH	EDI
   101 000000B9 56                              	PUSH	ESI
   102 000000BA 53                              	PUSH	EBX
   103 000000BB 8B 75 0C                        	MOV	ESI,DWORD [12+EBP]
   104 000000BE 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
   105 000000C1 8B 03                           	MOV	EAX,DWORD [EBX]
   106 000000C3 39 C1                           	CMP	ECX,EAX
   107 000000C5 73 0D                           	JAE	L30
   108 000000C7                                 L28:
   109 000000C7 8B 54 CB 14                     	MOV	EDX,DWORD [20+EBX+ECX*8]
   110 000000CB 39 F2                           	CMP	EDX,ESI
   111 000000CD 73 0C                           	JAE	L32
   112 000000CF 41                              	INC	ECX
   113 000000D0 39 C1                           	CMP	ECX,EAX
   114 000000D2 72 F3                           	JB	L28
   115 000000D4                                 L30:
   116 000000D4 31 C0                           	XOR	EAX,EAX
   117 000000D6                                 L16:
   118 000000D6 5B                              	POP	EBX
   119 000000D7 5E                              	POP	ESI
   120 000000D8 5F                              	POP	EDI
   121 000000D9 5D                              	POP	EBP
   122 000000DA C3                              	RET
   123 000000DB                                 L32:
   124 000000DB 8B 7C CB 10                     	MOV	EDI,DWORD [16+EBX+ECX*8]
   125 000000DF 8D 04 3E                        	LEA	EAX,DWORD [ESI+EDI*1]
   126 000000E2 89 44 CB 10                     	MOV	DWORD [16+EBX+ECX*8],EAX
   127 000000E6 89 D0                           	MOV	EAX,EDX
   128 000000E8 29 F0                           	SUB	EAX,ESI
   129 000000EA 89 44 CB 14                     	MOV	DWORD [20+EBX+ECX*8],EAX
   130 000000EE 85 C0                           	TEST	EAX,EAX
   131 000000F0 75 20                           	JNE	L22
   132 000000F2 8B 03                           	MOV	EAX,DWORD [EBX]
   133 000000F4 48                              	DEC	EAX
   134 000000F5 89 03                           	MOV	DWORD [EBX],EAX
   135 000000F7 39 C1                           	CMP	ECX,EAX
   136 000000F9 73 17                           	JAE	L22
   137 000000FB 89 C6                           	MOV	ESI,EAX
   138 000000FD                                 L27:
   139 000000FD 8B 44 CB 18                     	MOV	EAX,DWORD [24+EBX+ECX*8]
   140 00000101 8B 54 CB 1C                     	MOV	EDX,DWORD [28+EBX+ECX*8]
   141 00000105 89 44 CB 10                     	MOV	DWORD [16+EBX+ECX*8],EAX
   142 00000109 89 54 CB 14                     	MOV	DWORD [20+EBX+ECX*8],EDX
   143 0000010D 41                              	INC	ECX
   144 0000010E 39 F1                           	CMP	ECX,ESI
   145 00000110 72 EB                           	JB	L27
   146 00000112                                 L22:
   147 00000112 89 F8                           	MOV	EAX,EDI
   148 00000114 EB C0                           	JMP	L16
   149 00000116                                 	GLOBAL	_memman_free
   150 00000116                                 _memman_free:
   151 00000116 55                              	PUSH	EBP
   152 00000117 89 E5                           	MOV	EBP,ESP
   153 00000119 57                              	PUSH	EDI
   154 0000011A 56                              	PUSH	ESI
   155 0000011B 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   156 0000011E 53                              	PUSH	EBX
   157 0000011F 31 DB                           	XOR	EBX,EBX
   158 00000121 8B 3E                           	MOV	EDI,DWORD [ESI]
   159 00000123 39 FB                           	CMP	EBX,EDI
   160 00000125 7D 0E                           	JGE	L35
   161 00000127                                 L39:
   162 00000127 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   163 0000012A 39 44 DE 10                     	CMP	DWORD [16+ESI+EBX*8],EAX
   164 0000012E 77 05                           	JA	L35
   165 00000130 43                              	INC	EBX
   166 00000131 39 FB                           	CMP	EBX,EDI
   167 00000133 7C F2                           	JL	L39
   168 00000135                                 L35:
   169 00000135 85 DB                           	TEST	EBX,EBX
   170 00000137 7E 0F                           	JLE	L40
   171 00000139 8B 54 DE 0C                     	MOV	EDX,DWORD [12+ESI+EBX*8]
   172 0000013D 8B 44 DE 08                     	MOV	EAX,DWORD [8+ESI+EBX*8]
   173 00000141 01 D0                           	ADD	EAX,EDX
   174 00000143 3B 45 0C                        	CMP	EAX,DWORD [12+EBP]
   175 00000146 74 73                           	JE	L63
   176 00000148                                 L40:
   177 00000148 39 FB                           	CMP	EBX,EDI
   178 0000014A 7D 0C                           	JGE	L49
   179 0000014C 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   180 0000014F 03 45 10                        	ADD	EAX,DWORD [16+EBP]
   181 00000152 3B 44 DE 10                     	CMP	EAX,DWORD [16+ESI+EBX*8]
   182 00000156 74 53                           	JE	L64
   183 00000158                                 L49:
   184 00000158 81 FF 0000408F                  	CMP	EDI,16527
   185 0000015E 7F 3D                           	JG	L51
   186 00000160 89 F9                           	MOV	ECX,EDI
   187 00000162 39 DF                           	CMP	EDI,EBX
   188 00000164 7E 15                           	JLE	L61
   189 00000166                                 L56:
   190 00000166 8B 44 CE 08                     	MOV	EAX,DWORD [8+ESI+ECX*8]
   191 0000016A 8B 54 CE 0C                     	MOV	EDX,DWORD [12+ESI+ECX*8]
   192 0000016E 89 44 CE 10                     	MOV	DWORD [16+ESI+ECX*8],EAX
   193 00000172 89 54 CE 14                     	MOV	DWORD [20+ESI+ECX*8],EDX
   194 00000176 49                              	DEC	ECX
   195 00000177 39 D9                           	CMP	ECX,EBX
   196 00000179 7F EB                           	JG	L56
   197 0000017B                                 L61:
   198 0000017B 8D 47 01                        	LEA	EAX,DWORD [1+EDI]
   199 0000017E 89 06                           	MOV	DWORD [ESI],EAX
   200 00000180 39 46 04                        	CMP	DWORD [4+ESI],EAX
   201 00000183 7D 03                           	JGE	L57
   202 00000185 89 46 04                        	MOV	DWORD [4+ESI],EAX
   203 00000188                                 L57:
   204 00000188 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   205 0000018B 89 44 DE 10                     	MOV	DWORD [16+ESI+EBX*8],EAX
   206 0000018F 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   207 00000192 89 44 DE 14                     	MOV	DWORD [20+ESI+EBX*8],EAX
   208 00000196                                 L62:
   209 00000196 31 C0                           	XOR	EAX,EAX
   210 00000198                                 L33:
   211 00000198 5B                              	POP	EBX
   212 00000199 5E                              	POP	ESI
   213 0000019A 5F                              	POP	EDI
   214 0000019B 5D                              	POP	EBP
   215 0000019C C3                              	RET
   216 0000019D                                 L51:
   217 0000019D 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   218 000001A0 FF 46 0C                        	INC	DWORD [12+ESI]
   219 000001A3 01 46 08                        	ADD	DWORD [8+ESI],EAX
   220 000001A6 83 C8 FF                        	OR	EAX,-1
   221 000001A9 EB ED                           	JMP	L33
   222 000001AB                                 L64:
   223 000001AB 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   224 000001AE 89 44 DE 10                     	MOV	DWORD [16+ESI+EBX*8],EAX
   225 000001B2 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   226 000001B5 01 44 DE 14                     	ADD	DWORD [20+ESI+EBX*8],EAX
   227 000001B9 EB DB                           	JMP	L62
   228 000001BB                                 L63:
   229 000001BB 03 55 10                        	ADD	EDX,DWORD [16+EBP]
   230 000001BE 89 54 DE 0C                     	MOV	DWORD [12+ESI+EBX*8],EDX
   231 000001C2 3B 1E                           	CMP	EBX,DWORD [ESI]
   232 000001C4 7D D0                           	JGE	L62
   233 000001C6 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   234 000001C9 03 45 10                        	ADD	EAX,DWORD [16+EBP]
   235 000001CC 3B 44 DE 10                     	CMP	EAX,DWORD [16+ESI+EBX*8]
   236 000001D0 75 C4                           	JNE	L62
   237 000001D2 03 54 DE 14                     	ADD	EDX,DWORD [20+ESI+EBX*8]
   238 000001D6 89 54 DE 0C                     	MOV	DWORD [12+ESI+EBX*8],EDX
   239 000001DA 8B 06                           	MOV	EAX,DWORD [ESI]
   240 000001DC 48                              	DEC	EAX
   241 000001DD 89 06                           	MOV	DWORD [ESI],EAX
   242 000001DF 39 C3                           	CMP	EBX,EAX
   243 000001E1 7D B3                           	JGE	L62
   244 000001E3 89 C1                           	MOV	ECX,EAX
   245 000001E5                                 L48:
   246 000001E5 8B 44 DE 18                     	MOV	EAX,DWORD [24+ESI+EBX*8]
   247 000001E9 8B 54 DE 1C                     	MOV	EDX,DWORD [28+ESI+EBX*8]
   248 000001ED 89 44 DE 10                     	MOV	DWORD [16+ESI+EBX*8],EAX
   249 000001F1 89 54 DE 14                     	MOV	DWORD [20+ESI+EBX*8],EDX
   250 000001F5 43                              	INC	EBX
   251 000001F6 39 CB                           	CMP	EBX,ECX
   252 000001F8 7C EB                           	JL	L48
   253 000001FA EB 9A                           	JMP	L62
   254 000001FC                                 	GLOBAL	_memman_alloc_4k
   255 000001FC                                 _memman_alloc_4k:
   256 000001FC 55                              	PUSH	EBP
   257 000001FD 89 E5                           	MOV	EBP,ESP
   258 000001FF 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   259 00000202 05 00000FFF                     	ADD	EAX,4095
   260 00000207 25 FFFFF000                     	AND	EAX,-4096
   261 0000020C 89 45 0C                        	MOV	DWORD [12+EBP],EAX
   262 0000020F 5D                              	POP	EBP
   263 00000210 E9 FFFFFE9E                     	JMP	_memman_alloc
   264 00000215                                 	GLOBAL	_memman_free_4k
   265 00000215                                 _memman_free_4k:
   266 00000215 55                              	PUSH	EBP
   267 00000216 89 E5                           	MOV	EBP,ESP
   268 00000218 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   269 0000021B 05 00000FFF                     	ADD	EAX,4095
   270 00000220 25 FFFFF000                     	AND	EAX,-4096
   271 00000225 89 45 10                        	MOV	DWORD [16+EBP],EAX
   272 00000228 5D                              	POP	EBP
   273 00000229 E9 FFFFFEE8                     	JMP	_memman_free
