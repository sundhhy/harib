#include "bootpack.h"


//============================================================================//
//            G L O B A L   D E F I N I T I O N S                             //
//============================================================================//

//------------------------------------------------------------------------------
// const defines
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// module global vars
//------------------------------------------------------------------------------


//------------------------------------------------------------------------------
// global function prototypes
//------------------------------------------------------------------------------

//============================================================================//
//            P R I V A T E   D E F I N I T I O N S                           //
//============================================================================//

//------------------------------------------------------------------------------
// const defines
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// local types
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// local vars
//------------------------------------------------------------------------------


//------------------------------------------------------------------------------
// local function prototypes
//------------------------------------------------------------------------------



//============================================================================//
//            P U B L I C   F U N C T I O N S                                 //
//============================================================================//
void init_pic(void)
{
	io_out8( PIC0_IMR, 0XFF);	//ã÷é~èäóLíÜíf
	io_out8( PIC1_IMR, 0XFF);
	
	io_out8( PIC0_ICW1, 0x11); 			//?âàêG?
	io_out8( PIC0_ICW2, 0x20);		 	// irq 0 - 7 óRINT20 -27ê⁄ùæ
	io_out8( PIC0_ICW3, 1 << 2);	 	//PIC1óRIRQ2?ê⁄
	io_out8( PIC0_ICW4, 0x1); 			//ùŸ?ë∂ãÊñÕéÆ
	
	io_out8( PIC1_ICW1, 0x11); 			//?âàêG?
	io_out8( PIC1_ICW2, 0x20);		 	// irq 0 - 7 óRINT20 -27ê⁄ùæ
	io_out8( PIC1_ICW3, 2);	 			//PIC1?ê⁄ìûPIC0ìIIRQ2è„
	io_out8( PIC1_ICW4, 0x1); 			//ùŸ?ë∂ãÊñÕéÆ
	
	io_out8( PIC0_IMR, 0XFB);	//ã÷é~PIC1à»äOìIíÜíf
	io_out8( PIC1_IMR, 0XFF);
	
	return;
	
}

//??íÜíf
void inthandler21( int *esp)
{
	struct BOOTINFO *binfo = ( struct BOOTINFO *)ADR_BOOTINFO;
	BoxFill8( binfo->vram, binfo->scrnx, COL8_000000, 0, 0, 32 * 8 - 1, 15);
	Putfont8_asc( binfo->vram, binfo->scrnx, 0, 0,  COL8_FFFFFF, "INT 21 (IRQ1): PS/2 keyboard");
	
	for(;;)
	{
		io_hlt();
	}
	
}

void inthandler27( int *esp)
{
	
	io_out8(PIC0_OCW2, 0x67); /* IRQ-07éÛïtäÆóπÇPICÇ…í ím(7-1éQè∆) */
	return;	
}

void inthandler2c( int *esp)
{
	struct BOOTINFO *binfo = ( struct BOOTINFO *)ADR_BOOTINFO;
	BoxFill8( binfo->vram, binfo->scrnx, COL8_000000, 0, 0, 32 * 8 - 1, 15);
	Putfont8_asc( binfo->vram, binfo->scrnx, 0, 0,  COL8_FFFFFF, "INT 21 (IRQ1): PS/2 mouse");
	
	for(;;)
	{
		io_hlt();
	}
	
	
}
//=========================================================================//
//                                                                         //
//          P R I V A T E   D E F I N I T I O N S                          //
//                                                                         //
//=========================================================================//
/// \name Private Functions
/// \{













